# HTTP Proxy Log Viewer

A Next.js web application for visualizing and analyzing HTTP proxy logs generated by the proxy server.

## Features

- View all HTTP requests and responses logged by the proxy
- Filter logs by time range
- Search by method or path
- Detailed view of request/response headers and bodies
- JSON viewer with expand/collapse functionality
- JSONPath filtering for JSON data
- Special handling for Claude API SSE streams (automatically parses and displays the final message)
- Dark mode support

## Installation

```bash
cd apps/log-viewer
npm install
```

## Usage

### Development mode

```bash
npm run dev
```

The app will run on [http://localhost:3001](http://localhost:3001)

### Production build

```bash
npm run build
npm start
```

## Features in Detail

### Request List

- Shows all logged requests sorted by timestamp (newest first)
- Color-coded HTTP methods (GET, POST, PUT, DELETE, etc.)
- Status code display with color coding
- Time filtering with datetime pickers
- Search functionality

### Request Detail Panel

- Two tabs: Request and Response
- Displays metadata (headers, method, URL, status code, etc.)
- Body display with automatic format detection:
  - JSON: Interactive viewer with expand/collapse
  - Text/HTML/XML: Formatted text display
  - Binary files: Indicator with filename

### Claude API SSE Stream Support

When the viewer detects a Claude API response (user-agent contains "claude-cli" and content-type is "text/event-stream"):

- Automatically parses the SSE stream
- Displays the final assembled message
- Shows all stream events in a structured format
- Allows JSON path filtering on the parsed stream

### JSON Viewer

- Expand/collapse nodes (default: all expanded)
- JSONPath filtering to focus on specific parts of the data
- Syntax highlighting
- Dark mode support

## Project Structure

```
apps/log-viewer/
├── app/
│   ├── api/
│   │   └── logs/
│   │       ├── route.ts              # List all logs
│   │       └── [...id]/route.ts      # Get log detail
│   ├── layout.tsx                    # Root layout
│   ├── page.tsx                      # Main page
│   └── globals.css                   # Global styles
├── components/
│   ├── RequestList.tsx               # Request list with filtering
│   ├── RequestDetail.tsx             # Request/response detail view
│   └── JsonViewer.tsx                # JSON viewer with JSONPath
├── lib/
│   ├── logs.ts                       # Log reading utilities
│   └── sse-parser.ts                 # SSE stream parser
└── types/
    └── log.ts                        # TypeScript types
```

## Configuration

The viewer reads logs from `../../logs` (relative to the app directory). This assumes the following structure:

```
nodeproxy/
├── logs/                             # Proxy logs directory
│   └── 20260129_121400/
│       └── 1769660044974_POST_v1_messages/
│           ├── request_metadata.json
│           ├── request_body.json
│           ├── response_metadata.json
│           └── response_body.bin
└── apps/
    └── log-viewer/                   # This app
```

If your logs are in a different location, update the `LOG_DIR` constant in [lib/logs.ts](lib/logs.ts).

## License

MIT
